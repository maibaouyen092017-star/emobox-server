<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Emobox — Kết nối yêu thương</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <header class="topbar">
    <div class="brand">
      <img src="https://images.unsplash.com/photo-1544005313-94ddf0286df2?q=80&w=160&auto=format&fit=crop&ixlib=rb-4.0.3&s=9a3c3d5f3c8b2dc9f1d7b3d6f2f6c1d8"
           alt="logo" />
      <div>
        <h1>Emobox</h1>
        <p class="tag">Lời nói thân thương, nhắc nhớ từng phút</p>
      </div>
    </div>

    <div class="auth-area">
      <div id="userBadge" class="user-badge" style="display:none;">
        <span id="userName"></span>
        <button onclick="logout()" class="link-btn">Đăng xuất</button>
      </div>

      <div id="authForm" class="auth-form">
        <input id="email" placeholder="Email" type="email" />
        <input id="password" placeholder="Mật khẩu" type="password" />
        <div class="auth-btns">
          <button onclick="signup()" class="small">Đăng ký</button>
          <button onclick="login()" class="small primary">Đăng nhập</button>
        </div>
      </div>
    </div>
  </header>

  <main class="wrap">
    <section class="hero">
      <div class="hero-left">
        <h2>Giữ liên kết yêu thương — cho người già, cho gia đình</h2>
        <p>Ghi âm lời nhắn — đặt báo thức bằng giọng nói — gửi trực tiếp tới thiết bị Emobox ở viện dưỡng lão.</p>

        <div class="quick-actions">
          <button onclick="showTab('voicePanel')" class="cta">Gửi giọng nói ngay</button>
          <button onclick="showTab('alarmPanel')" class="cta alt">Đặt báo thức bằng giọng nói</button>
        </div>

        <div class="info-cards">
          <div class="card">
            <img src="https://images.unsplash.com/photo-1519340333755-7d8bb7b3d8c3?q=80&w=600&auto=format&fit=crop&ixlib=rb-4.0.3&s=601dafb2a4b3b4a5b3b8fde9a4f07e6b" alt="">
            <h4>Cho người già</h4>
            <p>Giọng nói thân thuộc giúp họ dễ phản ứng và cảm thấy an tâm.</p>
          </div>
          <div class="card">
            <img src="https://images.unsplash.com/photo-1524504388940-b1c1722653e1?q=80&w=600&auto=format&fit=crop&ixlib=rb-4.0.3&s=6d8b0ae6aef9d2b5b5f3a3b4f7d1db3d" alt="">
            <h4>Cho trẻ em</h4>
            <p>Tin nhắn giọng nói ấm áp cho bé ngủ ngon hoặc nhắc uống sữa.</p>
          </div>
        </div>
      </div>

      <div class="hero-right">
        <div class="panel" id="voicePanel">
          <h3>🎤 Gửi giọng nói trực tiếp</h3>
          <p class="muted">Ghi âm rồi gửi ngay — thiết bị sẽ phát lập tức nếu đang online.</p>

          <div class="rec-block">
            <button id="startVoice" onclick="startRecord('voice')" class="large">Bắt đầu</button>
            <button id="stopVoice" onclick="stopRecord('voice')" class="large" disabled> Dừng</button>
            <button id="sendVoice" onclick="sendVoiceNow()" class="large primary" disabled>Gửi</button>
            <audio id="audioVoice" controls></audio>
            <small class="hint">Lưu ý: bạn phải <b>đăng nhập</b> để gửi</small>
          </div>
        </div>

        <div class="panel" id="alarmPanel" style="display:none;">
          <h3>⏰ Đặt báo thức bằng giọng nói</h3>
          <p class="muted">Ghi âm tên báo thức (ví dụ "Uống thuốc") — chọn thời gian — tạo.</p>

          <div class="rec-block">
            <input id="alarmTime" type="datetime-local" />
            <div class="row">
              <button id="startAlarm" onclick="startRecord('alarm')" class="med">Ghi tên báo thức</button>
              <button id="stopAlarm" onclick="stopRecord('alarm')" class="med" disabled>Dừng</button>
              <button id="uploadAlarm" onclick="createAlarm()" class="med primary" disabled>Đặt báo thức</button>
            </div>
            <audio id="audioAlarm" controls></audio>
            <small class="hint">Báo thức sẽ phát <i>nhạc nền + giọng bạn</i> khi đến giờ.</small>
          </div>
        </div>

        <div class="panel" id="filesPanel" style="margin-top:14px;">
          <h4>📂 Bản ghi của bạn</h4>
          <ul id="fileList" class="file-list"></ul>
        </div>
      </div>
    </section>

    <section class="bottom">
      <div class="left">
        <h3>Hướng dẫn nhanh</h3>
        <ol>
          <li>Đăng ký / đăng nhập (góc phải trên)</li>
          <li>Ghi âm và <b>Gửi</b> hoặc <b>Đặt báo thức</b></li>
          <li>ESP32 sẽ nhận và phát khi đến giờ (hoặc ngay lập tức với <i>Gửi giọng nói</i>)</li>
        </ol>
      </div>

      <div class="right">
        <h3>Thiết bị & cấu hình</h3>
        <p>Phát hot-spot để cấu hình Wi-Fi, ESP lưu cấu hình và kết nối tới server của bạn.</p>
        <button onclick="openWifiModal()" class="small">Cấu hình Wi-Fi cho ESP</button>
      </div>
    </section>
  </main>

  <!-- Wifi modal -->
  <div id="wifiModal" class="modal" style="display:none;">
    <div class="modal-card">
      <h4>Gửi Wi-Fi đến ESP</h4>
      <input id="espId" placeholder="ESP ID (ví dụ emobox-01)">
      <input id="ssid" placeholder="SSID (wifi)">
      <input id="spass" placeholder="Password (wifi)">
      <div class="row right">
        <button onclick="closeWifiModal()">Đóng</button>
        <button class="primary" onclick="saveEspWifi()">Gửi</button>
      </div>
    </div>
  </div>

  <footer class="footer">
    © 2025 Emobox — Dự án KHKT. Nhớ thêm file <b>/music/alarm.mp3</b> vào server để báo thức phát nhạc nền.
  </footer>

  <script src="main.js"></script>
</body>
</html>
