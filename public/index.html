<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>EmoBox</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
 <!-- Thanh điều hướng -->
<header class="navbar">
 <div class="logo">
  <img src="/logo.jpg" alt="Logo" class="logo-img">
  <span>EmoBox-Gắn kết yêu thương</span>
</div>
  <div id="user-info" class="user-info">
    <button id="loginBtn" class="btn-primary">Đăng nhập</button>
    <button id="registerBtn" class="btn-outline">Đăng ký</button>
  </div>
</header>

<!-- Form Đăng nhập -->
<div id="login-modal" class="modal hidden">
  <div class="modal-content">
    <h3>Đăng nhập EmoBox</h3>
    <input type="text" id="login-username" placeholder="Tên đăng nhập" />
    <input type="password" id="login-password" placeholder="Mật khẩu" />
    <button id="doLogin">Đăng nhập</button>
    <p>Chưa có tài khoản? <a href="#" id="switchToRegister">Đăng ký</a></p>
  </div>
</div>

<!-- Form Đăng ký -->
<div id="register-modal" class="modal hidden">
  <div class="modal-content">
    <h3>Đăng ký tài khoản mới</h3>
    <input type="text" id="reg-username" placeholder="Tên đăng nhập" />
    <input type="password" id="reg-password" placeholder="Mật khẩu" />
    <button id="doRegister">Tạo tài khoản</button>
    <p>Đã có tài khoản? <a href="#" id="switchToLogin">Đăng nhập</a></p>
  </div>
</div>


  <main>
    <section class="card">
      <h3>🎤 Gửi lời nhắn ngay (Realtime)</h3>
      <button id="recordBtn" class="red">🎙️ Ghi âm ngay</button>
      <button id="stopBtn" class="gray">⏹️ Dừng</button>
      <input id="msgTitle" placeholder="Tiêu đề (ví dụ: Lời chúc)">
      <button id="sendBtn" class="green">📤 Gửi ngay</button>
      <audio id="audioPlayer" controls></audio>
    </section>

    <section class="card">
      <h3>⏰ Đặt báo thức bằng giọng nói</h3>
      <input id="alarmDate" type="date">
      <input id="alarmTime" type="time">
      <input id="alarmTitle" placeholder="Tên báo thức (VD: Ăn sáng)">
      <button id="alarmRecordBtn" class="yellow">🎙️ Ghi âm cho báo thức</button>
      <button id="alarmStopBtn" class="gray">⏹️ Dừng</button>
      <button id="saveAlarmBtn" class="blue">💾 Lưu báo thức</button>
      <audio id="alarmAudio" controls></audio>
    </section>

    <section class="card">
      <h3>🔔 Lịch & Tin nhắn của bạn</h3>
      <div id="messageList"></div>
    </section>

    <section class="card">
      <h3>📘 Hướng dẫn sử dụng</h3>
      <p>- Ghi âm và gửi tin nhắn: chọn "Gửi lời nhắn ngay", thu âm, nghe lại và gửi.<br>
      - Đặt báo thức bằng giọng nói: chọn ngày, giờ, ghi âm lời nhắc.<br>
      - ESP sẽ phát lại tin nhắn/báo thức khi đến giờ.<br>
      - Cần đăng nhập để lưu lịch sử và gửi voice.</p>
    </section>
  </main>

  <footer>
    <p>©2025-Mai Phước Gia Bảo- Dự án khoa học kĩ thuật</p>
  </footer>
<script>
  // =============================
  // 📦 Modal Đăng nhập / Đăng ký
  // =============================
  const modal = document.getElementById("authModal");
  const loginOpen = document.getElementById("loginOpen");
  const registerOpen = document.getElementById("registerOpen");

  // Mở modal
  loginOpen.onclick = () => {
    modal.classList.remove("hidden");
    document.getElementById("authMsg").innerText = "";
  };
  registerOpen.onclick = () => {
    modal.classList.remove("hidden");
    document.getElementById("authMsg").innerText = "";
  };

  // Đóng modal khi click ra ngoài
  modal.addEventListener("click", (e) => {
    if (e.target === modal) modal.classList.add("hidden");
  });

  // =============================
  // 🔑 Đăng nhập / Đăng ký
  // =============================
  document.getElementById("loginBtn").onclick = async () => {
    const username = document.getElementById("username").value.trim();
    const password = document.getElementById("password").value.trim();

    if (!username || !password)
      return (document.getElementById("authMsg").innerText = "⚠️ Vui lòng nhập đủ thông tin!");

    try {
      const res = await fetch("/auth/login", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ username, password }),
      });
      const data = await res.json();
      if (res.ok) {
        document.getElementById("authMsg").innerText = "✅ Đăng nhập thành công!";
        localStorage.setItem("user", username);
        setTimeout(() => {
          modal.classList.add("hidden");
          updateUI();
        }, 1000);
      } else {
        document.getElementById("authMsg").innerText = data.message || "❌ Sai tài khoản!";
      }
    } catch (err) {
      document.getElementById("authMsg").innerText = "⚠️ Lỗi máy chủ!";
    }
  };

  document.getElementById("registerBtn").onclick = async () => {
    const username = document.getElementById("username").value.trim();
    const password = document.getElementById("password").value.trim();

    if (!username || !password)
      return (document.getElementById("authMsg").innerText = "⚠️ Vui lòng nhập đủ thông tin!");

    try {
      const res = await fetch("/auth/register", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ username, password }),
      });
      const data = await res.json();
      if (res.ok) {
        document.getElementById("authMsg").innerText = "✅ Đăng ký thành công!";
      } else {
        document.getElementById("authMsg").innerText = data.message || "⚠️ Lỗi đăng ký!";
      }
    } catch (err) {
      document.getElementById("authMsg").innerText = "⚠️ Lỗi máy chủ!";
    }
  };

  // =============================
  // 🚪 Đăng xuất
  // =============================
  function logout() {
    localStorage.removeItem("user");
    updateUI();
  }

  // =============================
  // 👤 Cập nhật giao diện login/logout
  // =============================
  function updateUI() {
    const user = localStorage.getItem("user");
    const headerDiv = document.querySelector("header div");
    headerDiv.innerHTML = "";

    if (user) {
      const hello = document.createElement("span");
      hello.textContent = `👋 Xin chào, ${user}`;
      hello.className = "text-white bg-blue-500 px-3 py-1 rounded mr-2";

      const logoutBtn = document.createElement("button");
      logoutBtn.textContent = "Đăng xuất";
      logoutBtn.className = "bg-red-500 text-white px-3 py-1 rounded";
      logoutBtn.onclick = logout;

      headerDiv.appendChild(hello);
      headerDiv.appendChild(logoutBtn);
    } else {
      const loginBtn = document.createElement("button");
      loginBtn.id = "loginOpen";
      loginBtn.textContent = "Đăng nhập";
      loginBtn.className = "bg-blue-500 text-white px-3 py-1 rounded mr-2";
      loginBtn.onclick = () => modal.classList.remove("hidden");

      const registerBtn = document.createElement("button");
      registerBtn.id = "registerOpen";
      registerBtn.textContent = "Đăng ký";
      registerBtn.className = "bg-green-500 text-white px-3 py-1 rounded";
      registerBtn.onclick = () => modal.classList.remove("hidden");

      headerDiv.appendChild(loginBtn);
      headerDiv.appendChild(registerBtn);
    }
  }

  // Khi load lại trang
  window.addEventListener("DOMContentLoaded", updateUI);
</script>


  <script defer src="/script.js"></script>
</body>
</html>
