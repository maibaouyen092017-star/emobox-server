<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>EmoBox</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
 <!-- Thanh Ä‘iá»u hÆ°á»›ng -->
<header class="navbar">
 <div class="logo">
  <img src="/logo.jpg" alt="Logo" class="logo-img">
  <span>EmoBox-Gáº¯n káº¿t yÃªu thÆ°Æ¡ng</span>
</div>
  <div id="user-info" class="user-info">
    <button id="loginBtn" class="btn-primary">ÄÄƒng nháº­p</button>
    <button id="registerBtn" class="btn-outline">ÄÄƒng kÃ½</button>
  </div>
</header>

<!-- Form ÄÄƒng nháº­p -->
<div id="login-modal" class="modal hidden">
  <div class="modal-content">
    <h3>ÄÄƒng nháº­p EmoBox</h3>
    <input type="text" id="login-username" placeholder="TÃªn Ä‘Äƒng nháº­p" />
    <input type="password" id="login-password" placeholder="Máº­t kháº©u" />
    <button id="doLogin">ÄÄƒng nháº­p</button>
    <p>ChÆ°a cÃ³ tÃ i khoáº£n? <a href="#" id="switchToRegister">ÄÄƒng kÃ½</a></p>
  </div>
</div>

<!-- Form ÄÄƒng kÃ½ -->
<div id="register-modal" class="modal hidden">
  <div class="modal-content">
    <h3>ÄÄƒng kÃ½ tÃ i khoáº£n má»›i</h3>
    <input type="text" id="reg-username" placeholder="TÃªn Ä‘Äƒng nháº­p" />
    <input type="password" id="reg-password" placeholder="Máº­t kháº©u" />
    <button id="doRegister">Táº¡o tÃ i khoáº£n</button>
    <p>ÄÃ£ cÃ³ tÃ i khoáº£n? <a href="#" id="switchToLogin">ÄÄƒng nháº­p</a></p>
  </div>
</div>


  <main>
    <section class="card">
      <h3>ğŸ¤ Gá»­i lá»i nháº¯n ngay (Realtime)</h3>
      <button id="recordBtn" class="red">ğŸ™ï¸ Ghi Ã¢m ngay</button>
      <button id="stopBtn" class="gray">â¹ï¸ Dá»«ng</button>
      <input id="msgTitle" placeholder="TiÃªu Ä‘á» (vÃ­ dá»¥: Lá»i chÃºc)">
      <button id="sendBtn" class="green">ğŸ“¤ Gá»­i ngay</button>
      <audio id="audioPlayer" controls></audio>
    </section>

    <section class="card">
      <h3>â° Äáº·t bÃ¡o thá»©c báº±ng giá»ng nÃ³i</h3>
      <input id="alarmDate" type="date">
      <input id="alarmTime" type="time">
      <input id="alarmTitle" placeholder="TÃªn bÃ¡o thá»©c (VD: Ä‚n sÃ¡ng)">
      <button id="alarmRecordBtn" class="yellow">ğŸ™ï¸ Ghi Ã¢m cho bÃ¡o thá»©c</button>
      <button id="alarmStopBtn" class="gray">â¹ï¸ Dá»«ng</button>
      <button id="saveAlarmBtn" class="blue">ğŸ’¾ LÆ°u bÃ¡o thá»©c</button>
      <audio id="alarmAudio" controls></audio>
    </section>

    <section class="card">
      <h3>ğŸ”” Lá»‹ch & Tin nháº¯n cá»§a báº¡n</h3>
      <div id="messageList"></div>
    </section>

    <section class="card">
      <h3>ğŸ“˜ HÆ°á»›ng dáº«n sá»­ dá»¥ng</h3>
      <p>- Ghi Ã¢m vÃ  gá»­i tin nháº¯n: chá»n "Gá»­i lá»i nháº¯n ngay", thu Ã¢m, nghe láº¡i vÃ  gá»­i.<br>
      - Äáº·t bÃ¡o thá»©c báº±ng giá»ng nÃ³i: chá»n ngÃ y, giá», ghi Ã¢m lá»i nháº¯c.<br>
      - ESP sáº½ phÃ¡t láº¡i tin nháº¯n/bÃ¡o thá»©c khi Ä‘áº¿n giá».<br>
      - Cáº§n Ä‘Äƒng nháº­p Ä‘á»ƒ lÆ°u lá»‹ch sá»­ vÃ  gá»­i voice.</p>
    </section>
  </main>

  <footer>
    <p>Â©2025-Mai PhÆ°á»›c Gia Báº£o- Dá»± Ã¡n khoa há»c kÄ© thuáº­t</p>
  </footer>
<script>
  // =============================
  // ğŸ“¦ Modal ÄÄƒng nháº­p / ÄÄƒng kÃ½
  // =============================
  const modal = document.getElementById("authModal");
  const loginOpen = document.getElementById("loginOpen");
  const registerOpen = document.getElementById("registerOpen");

  // Má»Ÿ modal
  loginOpen.onclick = () => {
    modal.classList.remove("hidden");
    document.getElementById("authMsg").innerText = "";
  };
  registerOpen.onclick = () => {
    modal.classList.remove("hidden");
    document.getElementById("authMsg").innerText = "";
  };

  // ÄÃ³ng modal khi click ra ngoÃ i
  modal.addEventListener("click", (e) => {
    if (e.target === modal) modal.classList.add("hidden");
  });

  // =============================
  // ğŸ”‘ ÄÄƒng nháº­p / ÄÄƒng kÃ½
  // =============================
  document.getElementById("loginBtn").onclick = async () => {
    const username = document.getElementById("username").value.trim();
    const password = document.getElementById("password").value.trim();

    if (!username || !password)
      return (document.getElementById("authMsg").innerText = "âš ï¸ Vui lÃ²ng nháº­p Ä‘á»§ thÃ´ng tin!");

    try {
      const res = await fetch("/auth/login", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ username, password }),
      });
      const data = await res.json();
      if (res.ok) {
        document.getElementById("authMsg").innerText = "âœ… ÄÄƒng nháº­p thÃ nh cÃ´ng!";
        localStorage.setItem("user", username);
        setTimeout(() => {
          modal.classList.add("hidden");
          updateUI();
        }, 1000);
      } else {
        document.getElementById("authMsg").innerText = data.message || "âŒ Sai tÃ i khoáº£n!";
      }
    } catch (err) {
      document.getElementById("authMsg").innerText = "âš ï¸ Lá»—i mÃ¡y chá»§!";
    }
  };

  document.getElementById("registerBtn").onclick = async () => {
    const username = document.getElementById("username").value.trim();
    const password = document.getElementById("password").value.trim();

    if (!username || !password)
      return (document.getElementById("authMsg").innerText = "âš ï¸ Vui lÃ²ng nháº­p Ä‘á»§ thÃ´ng tin!");

    try {
      const res = await fetch("/auth/register", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ username, password }),
      });
      const data = await res.json();
      if (res.ok) {
        document.getElementById("authMsg").innerText = "âœ… ÄÄƒng kÃ½ thÃ nh cÃ´ng!";
      } else {
        document.getElementById("authMsg").innerText = data.message || "âš ï¸ Lá»—i Ä‘Äƒng kÃ½!";
      }
    } catch (err) {
      document.getElementById("authMsg").innerText = "âš ï¸ Lá»—i mÃ¡y chá»§!";
    }
  };

  // =============================
  // ğŸšª ÄÄƒng xuáº¥t
  // =============================
  function logout() {
    localStorage.removeItem("user");
    updateUI();
  }

  // =============================
  // ğŸ‘¤ Cáº­p nháº­t giao diá»‡n login/logout
  // =============================
  function updateUI() {
    const user = localStorage.getItem("user");
    const headerDiv = document.querySelector("header div");
    headerDiv.innerHTML = "";

    if (user) {
      const hello = document.createElement("span");
      hello.textContent = `ğŸ‘‹ Xin chÃ o, ${user}`;
      hello.className = "text-white bg-blue-500 px-3 py-1 rounded mr-2";

      const logoutBtn = document.createElement("button");
      logoutBtn.textContent = "ÄÄƒng xuáº¥t";
      logoutBtn.className = "bg-red-500 text-white px-3 py-1 rounded";
      logoutBtn.onclick = logout;

      headerDiv.appendChild(hello);
      headerDiv.appendChild(logoutBtn);
    } else {
      const loginBtn = document.createElement("button");
      loginBtn.id = "loginOpen";
      loginBtn.textContent = "ÄÄƒng nháº­p";
      loginBtn.className = "bg-blue-500 text-white px-3 py-1 rounded mr-2";
      loginBtn.onclick = () => modal.classList.remove("hidden");

      const registerBtn = document.createElement("button");
      registerBtn.id = "registerOpen";
      registerBtn.textContent = "ÄÄƒng kÃ½";
      registerBtn.className = "bg-green-500 text-white px-3 py-1 rounded";
      registerBtn.onclick = () => modal.classList.remove("hidden");

      headerDiv.appendChild(loginBtn);
      headerDiv.appendChild(registerBtn);
    }
  }

  // Khi load láº¡i trang
  window.addEventListener("DOMContentLoaded", updateUI);
</script>


  <script defer src="/script.js"></script>
</body>
</html>
