<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>EmoBox</title>
  <link rel="stylesheet" href="style.css">
  <style>
    /* Náº¿u báº¡n khÃ´ng dÃ¹ng Tailwind, thÃªm CSS áº©n/hiá»‡n cÆ¡ báº£n */
    .hidden { display: none; }
    #authModal {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.5);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 999;
    }
    #authModal .box {
      background: white;
      padding: 20px;
      border-radius: 12px;
      width: 350px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.2);
    }
    #authModal input {
      width: 100%;
      padding: 8px;
      margin: 6px 0;
    }
    #authModal button {
      width: 100%;
      margin-top: 8px;
      padding: 8px;
    }
  </style>
</head>
<body>

  <!-- âœ… Thanh Ä‘iá»u hÆ°á»›ng -->
  <header class="navbar">
    <div class="logo">
      <img src="/logo.jpg" alt="Logo" class="logo-img">
      <span>EmoBox - Gáº¯n káº¿t yÃªu thÆ°Æ¡ng</span>
    </div>
    <div id="user-info" class="user-info">
      <button id="loginBtn" class="btn-primary">ÄÄƒng nháº­p</button>
      <button id="registerBtn" class="btn-outline">ÄÄƒng kÃ½</button>
      <button id="logoutBtn" class="btn-gray hidden">ÄÄƒng xuáº¥t</button>
    </div>
  </header>

  <!-- âœ… Modal Ä‘Äƒng nháº­p / Ä‘Äƒng kÃ½ -->
  <div id="authModal" class="hidden">
    <div class="box">
      <h2 id="authTitle" class="text-xl font-bold mb-4">ÄÄƒng nháº­p</h2>
      <input type="text" id="authUsername" placeholder="TÃªn Ä‘Äƒng nháº­p" />
      <input type="password" id="authPassword" placeholder="Máº­t kháº©u" />
      <button id="submitAuth" class="bg-blue-600 text-white">XÃ¡c nháº­n</button>
      <button id="closeAuth">ÄÃ³ng</button>
    </div>
  </div>

  <main>
    <section class="card">
      <h3>ğŸ¤ Gá»­i lá»i nháº¯n ngay (Realtime)</h3>
      <button id="recordBtn" class="red">ğŸ™ï¸ Ghi Ã¢m ngay</button>
      <button id="stopBtn" class="gray">â¹ï¸ Dá»«ng</button>
      <input id="msgTitle" placeholder="TiÃªu Ä‘á» (vÃ­ dá»¥: Lá»i chÃºc)">
      <button id="sendBtn" class="green">ğŸ“¤ Gá»­i ngay</button>
      <audio id="audioPlayer" controls></audio>
    </section>

    <section class="card">
      <h3>â° Äáº·t bÃ¡o thá»©c báº±ng giá»ng nÃ³i</h3>
      <input id="alarmDate" type="date">
      <input id="alarmTime" type="time">
      <input id="alarmTitle" placeholder="TÃªn bÃ¡o thá»©c (VD: Ä‚n sÃ¡ng)">
      <button id="alarmRecordBtn" class="yellow">ğŸ™ï¸ Ghi Ã¢m cho bÃ¡o thá»©c</button>
      <button id="alarmStopBtn" class="gray">â¹ï¸ Dá»«ng</button>
      <button id="saveAlarmBtn" class="blue">ğŸ’¾ LÆ°u bÃ¡o thá»©c</button>
      <audio id="alarmAudio" controls></audio>
    </section>

    <section class="card">
      <h3>ğŸ”” Lá»‹ch & Tin nháº¯n cá»§a báº¡n</h3>
      <div id="messageList"></div>
    </section>

    <section class="card">
      <h3>ğŸ“˜ HÆ°á»›ng dáº«n sá»­ dá»¥ng</h3>
      <p>
        - Ghi Ã¢m vÃ  gá»­i tin nháº¯n: chá»n "Gá»­i lá»i nháº¯n ngay", thu Ã¢m, nghe láº¡i vÃ  gá»­i.<br>
        - Äáº·t bÃ¡o thá»©c báº±ng giá»ng nÃ³i: chá»n ngÃ y, giá», ghi Ã¢m lá»i nháº¯c.<br>
        - ESP sáº½ phÃ¡t láº¡i tin nháº¯n/bÃ¡o thá»©c khi Ä‘áº¿n giá».<br>
        - Cáº§n Ä‘Äƒng nháº­p Ä‘á»ƒ lÆ°u lá»‹ch sá»­ vÃ  gá»­i voice.
      </p>
    </section>
  </main>

  <footer>
    <p>Â©2025 - Mai PhÆ°á»›c Gia Báº£o - Dá»± Ã¡n khoa há»c ká»¹ thuáº­t</p>
  </footer>

  <!-- âœ… Script xá»­ lÃ½ Ä‘Äƒng nháº­p / Ä‘Äƒng kÃ½ -->
  <script>
  const API_URL = "https://emobox-server.onrender.com";

  const loginBtn = document.getElementById("loginBtn");
  const registerBtn = document.getElementById("registerBtn");
  const logoutBtn = document.getElementById("logoutBtn");
  const modal = document.getElementById("authModal");
  const authTitle = document.getElementById("authTitle");
  const username = document.getElementById("authUsername");
  const password = document.getElementById("authPassword");
  const submitAuth = document.getElementById("submitAuth");
  const closeAuth = document.getElementById("closeAuth");

  let currentMode = "login"; // login / register

  // má»Ÿ form Ä‘Äƒng nháº­p
  loginBtn.addEventListener("click", () => {
    modal.classList.remove("hidden");
    authTitle.textContent = "ÄÄƒng nháº­p";
    currentMode = "login";
  });

  // má»Ÿ form Ä‘Äƒng kÃ½
  registerBtn.addEventListener("click", () => {
    modal.classList.remove("hidden");
    authTitle.textContent = "ÄÄƒng kÃ½";
    currentMode = "register";
  });

  // Ä‘Ã³ng modal
  closeAuth.addEventListener("click", () => modal.classList.add("hidden"));

  // gá»­i dá»¯ liá»‡u
  submitAuth.addEventListener("click", async () => {
    const body = {
      username: username.value.trim(),
      password: password.value.trim(),
    };
    if (!body.username || !body.password) {
      alert("Vui lÃ²ng nháº­p Ä‘áº§y Ä‘á»§ thÃ´ng tin!");
      return;
    }

    const endpoint = currentMode === "login" ? "/auth/login" : "/auth/register";

    try {
      const res = await fetch(API_URL + endpoint, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(body),
      });
      const data = await res.json();

      if (data.success) {
        alert(currentMode === "login" ? "ÄÄƒng nháº­p thÃ nh cÃ´ng!" : "ÄÄƒng kÃ½ thÃ nh cÃ´ng!");
        modal.classList.add("hidden");
        localStorage.setItem("token", data.token || "");
        loginBtn.classList.add("hidden");
        registerBtn.classList.add("hidden");
        logoutBtn.classList.remove("hidden");
      } else {
        alert(data.message || "CÃ³ lá»—i xáº£y ra!");
      }
    } catch (err) {
      console.error(err);
      alert("KhÃ´ng thá»ƒ káº¿t ná»‘i server!");
    }
  });

  // Ä‘Äƒng xuáº¥t
  logoutBtn.addEventListener("click", () => {
    localStorage.removeItem("token");
    alert("ÄÃ£ Ä‘Äƒng xuáº¥t!");
    logoutBtn.classList.add("hidden");
    loginBtn.classList.remove("hidden");
    registerBtn.classList.remove("hidden");
  });
  </script>

</body>
</html>
